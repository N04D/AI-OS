{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ai-os.local/schemas/security/secrets-boundary.schema.json",
  "title": "AI-OS Secrets Boundary Policy",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "version",
    "plaintext_to_tool_forbidden",
    "secret_aliases",
    "injection_rules",
    "audit"
  ],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^v[0-9]+\\.[0-9]+$"
    },
    "plaintext_to_tool_forbidden": {
      "type": "boolean",
      "const": true
    },
    "secret_aliases": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["alias", "provider", "secret_ref"],
        "properties": {
          "alias": {
            "type": "string",
            "pattern": "^[a-z0-9_\\-]+$"
          },
          "provider": {
            "type": "string"
          },
          "secret_ref": {
            "type": "string",
            "description": "Opaque reference/id in secret backend"
          },
          "expires_required": {
            "type": "boolean",
            "default": false
          }
        }
      }
    },
    "injection_rules": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["alias", "target", "location", "effect"],
        "properties": {
          "alias": {
            "type": "string",
            "pattern": "^[a-z0-9_\\-]+$"
          },
          "target": {
            "type": "object",
            "additionalProperties": false,
            "required": ["host_pattern"],
            "properties": {
              "host_pattern": {
                "type": "string",
                "pattern": "^(\\*\\.)?[A-Za-z0-9.-]+$"
              },
              "path_prefix": {
                "type": "string",
                "default": "/"
              }
            }
          },
          "location": {
            "type": "object",
            "additionalProperties": false,
            "required": ["type"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["bearer", "header", "query_param", "url_path"]
              },
              "name": {
                "type": "string"
              },
              "prefix": {
                "type": "string"
              }
            }
          },
          "effect": {
            "type": "string",
            "enum": ["allow", "review", "warn", "block"]
          }
        }
      }
    },
    "audit": {
      "type": "object",
      "additionalProperties": false,
      "required": ["emit_secret_use_events", "redact_secret_values"],
      "properties": {
        "emit_secret_use_events": {
          "type": "boolean",
          "const": true
        },
        "redact_secret_values": {
          "type": "boolean",
          "const": true
        }
      }
    }
  }
}
